mode: debug  # debug, devel or prod
prefix: https://iridl.ldeo.columbia.edu
core_path: /fbfmaproom
admin_path: /fbfmaproom-admin
tile_path: /fbfmaproom-tiles
support_email: help@iri.columbia.edu
bypass_dlauth: true
loglevel: info
gantt_url: https://fist-fbf-gantt.iri.columbia.edu/gantt?

dlauth_client:
    prefix: https://iridl.ldeo.columbia.edu
    core_path: /auth
    session_cookie_name: __dlauth_id
    application_ssid: SNIP

flask:
    host: localhost
    port: 443
    debug: false
    threaded: false
    processes: 1

bjoern:
    host: localhost
    port: 8080

dbpool:
    name: DesignEngine  # postgres database name
    host: pgdb12.iri.columbia.edu
    port: 5432
    user: dero  # user name
    password: SNIP
    capacity: 10  # number of connections in pool
    close_on_exception: true
    max_idle_time: 60  # (seconds)
    max_open_time: 600  # (seconds)
    max_usage_count: 1000
    recycle_interval: 60  # (seconds) set to null to disable recycler thread

dataframes:
    bad_years:
        schema: public
        table: fbf_maproom
    enso: enso.zarr


data_root: /data/aaron/fbf

custom_asset_path: /path/to/my/custom/icons/directory

countries:
    malawi:
        logo: Malawi_IRI_98x48.png
        resolution: [1, 1]
        center: [37.5, -13]
        zoom: 7
        rotation: 0
        marker: [34, -14]
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Malawi'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Malawi'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Malawi'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Malawi' group by 1, 2
        datasets:
            observations:
                rain:
                    label: Rain
                    path: rain-malawi.zarr
                    var_names:
                        obs: prcp_est
                        lat: Y
                        lon: X
                        time: T
                    colormap: &raincm "[16777215 16777215 12632256 12632256 14155730
                        [14155730 21] 12841150 [12841150 23] 10215830 [10215830 23]
                        7262835 [7262835 22] 6931300 [6931300 23] 5944410 [5944410 23]
                        5285200 [5285200 23] 4625990 [4625990 22] 3966780 [3966780 23]
                        3307570 [3307570 23] 2648360 [2648360 23] 1989150]"
                ndvi:
                    label: NDVI
                    path: rain-malawi.zarr
                    var_names:
                        obs: prcp_est
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
                wrsi:
                    label: WRSI
                    path: rain-malawi.zarr
                    var_names:
                        obs: prcp_est
                        lat: Y
                        lon: X
                        time: T
                    colormap: *raincm
            pnep:
                path: pnep-malawi.zarr
                var_names:
                    pnep: prob
                    lat: Y
                    lon: X
                    issue: S
                    lead: L
                    pct: P
                colormap: &pnepcm "[0x0000ba 0x004fff 0x3ec5f5 0x7fffd4 0x97fc00
                    0xd8fe00 0xffe800 0xffac00 0xff7b00 0xff5900 0xff3500 0xff1300
                    0xef0000 0xd10000 0xb00000 0x8f0000 [0x800000 4]]"
            vuln:
                colormap: &vulncm "[[0xffff00 5] 0xfff500 0xffde00 0xffc300 0xffae00
                    0xff9900 0xff7e00 0xff6200 0xff4600 0xff2f00 0xff0b00 0xf70000
                    0xdb0000 0xbf0000 0xa60000 0x8a0000 [0x800000 5]]"
                range: [0.0, 5.0]
        seasons:
            season1:
                label: DJF
                target_month: 0.5  # season center in months since Jan 1: 0.0 <= season < 12.0
                length: 3.0
                issue_months: [7, 8, 9, 10]  # months since Jan 1: 0.0 <= season < 12.0
                year_range: [1983, 2021]

    madagascar:
        logo: Madagascar_IRI_98x48.png
        resolution: [.0375, .0375]
        center: [49, -23]
        zoom: 7
        rotation: 0
        marker: [45.5, -24]
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(ST_Union(the_geom)) as the_geom
                  from iridb.g2015_2014_1 g where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
                  group by 1, 2
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Madagascar'
                  and adm1_name in ('Androy', 'Anosy', 'Atsimo Andrefana', 'Atsimo Atsinanana')
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Madagascar' group by 1, 2

        datasets:
            rain:
                path: rain-madagascar.zarr
                var_names:
                    obs: rfe
                    lat: Y
                    lon: X
                    time: T
                colormap: *raincm
            pnep:
                path: pnep-madagascar.zarr
                var_names:
                    pnep: pne
                    lat: Y
                    lon: X
                    issue: S
                    lead: null  # dataset has forecasts for only one season; L is implicit.
                    pct: P
                colormap: *pnepcm
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: DJF
                target_month: 0.5  # season center in months since Jan 1: 0.0 <= season < 12.0
                length: 3.0
                issue_months: [8, 9, 10]  # months since Jan 1: 0.0 <= season < 12.0
                year_range: [1982, 2022]

    ethiopia:
        logo: Ethiopia_IRI_98x48.png
        resolution: [.25, .25]
        center: [43.875, 6.875]
        zoom: 6
        rotation: 0
        marker:  [43.875, 6.875]
        origin: [.125, .125]
        shapes:
            - name: Regional
              sql: select (adm1_pcode) as key, adm1_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_region
              vuln_sql: select (adm1_pcode) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability_ethiopia_somali group by 1, 2

            - name: Zonal
              sql: select (adm1_pcode, adm2_pcode) as key, adm2_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_zone
              vuln_sql: select (adm1_pcode, adm2_pcode) as key, year, vulnerability as vuln
                  from public.fbf_vulnerability_ethiopia_somali

            - name: Woreda
              sql: select (adm1_pcode, adm2_pcode, adm3_pcode) as key, adm3_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_woreda
              vuln_sql: select (g.adm1_pcode, g.adm2_pcode, g.adm3_pcode) as key, g.adm3_en as label,
                  v.year, v.vulnerability as vuln from iridb.somali_woreda as g join
                  public.fbf_vulnerability_ethiopia_somali as v on (g.adm1_pcode=v.adm1_pcode and
                  g.adm2_pcode=v.adm2_pcode)

        datasets:
            rain:
                path: rain-ethiopia.zarr
                var_names:
                    obs: prcp
                    lat: Y
                    lon: X
                    time: T
                colormap: *raincm
            pnep:
                path: pnep-ethiopia.zarr
                var_names:
                    pnep: pne
                    lat: Y
                    lon: X
                    issue: S
                    lead: null  # dataset has forecasts for only one season; L is implicit.
                    pct: P
                colormap: *pnepcm
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: MAM
                target_month: 3.5
                length: 3.0
                issue_months: [11, 0, 1]
                year_range: [1983, 2021]
    ethiopia-ond:
        logo: Ethiopia_IRI_98x48.png
        resolution: [.25, .25]
        center: [43.875, 6.875]
        zoom: 6
        rotation: 0
        marker:  [43.875, 6.875]
        origin: [.125, .125]
        shapes:
            - name: Regional
              sql: select (adm1_pcode) as key, adm1_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_region
              vuln_sql: select (adm1_pcode) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability_ethiopia_somali group by 1, 2

            - name: Zonal
              sql: select (adm1_pcode, adm2_pcode) as key, adm2_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_zone
              vuln_sql: select (adm1_pcode, adm2_pcode) as key, year, vulnerability as vuln
                  from public.fbf_vulnerability_ethiopia_somali

            - name: Woreda
              sql: select (adm1_pcode, adm2_pcode, adm3_pcode) as key, adm3_en as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.somali_woreda
              vuln_sql: select (g.adm1_pcode, g.adm2_pcode, g.adm3_pcode) as key, g.adm3_en as label,
                  v.year, v.vulnerability as vuln from iridb.somali_woreda as g join
                  public.fbf_vulnerability_ethiopia_somali as v on (g.adm1_pcode=v.adm1_pcode and
                  g.adm2_pcode=v.adm2_pcode)

        datasets:
            rain:
                path: rain-ethiopia-ond.zarr
                var_names:
                    obs: prcp
                    lat: Y
                    lon: X
                    time: T
                colormap: *raincm
            pnep:
                path: pnep-ethiopia-ond.zarr
                var_names:
                    pnep: pne
                    lat: Y
                    lon: X
                    issue: S
                    lead: null  # dataset has forecasts for only one season; L is implicit.
                    pct: P
                colormap: *pnepcm
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season2:
                label: OND
                target_month: 10.5
                length: 3.0
                issue_months: [8, 7, 6]
                year_range: [1982, 2020]
    niger:
        logo: Niger_IRI_120x48.png
        resolution: [0.05, 0.05]
        center: [8.1, 17]
        zoom: 6
        rotation: 0
        marker: [8.025, 17.025]
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Niger'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Niger'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Niger'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Niger' group by 1, 2

        datasets:
            rain:
                path: rain-niger.zarr
                var_names:
                    obs: obs
                    lat: Y
                    lon: X
                    time: T
                colormap: *raincm
            pnep:
                path: pnep-niger.zarr
                var_names:
                    pnep: pne
                    lat: Y
                    lon: X
                    issue: S
                    lead: null  # dataset has forecasts for only one season; L is implicit.
                    pct: P
                colormap: *pnepcm
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: JAS
                target_month: 7.5
                length: 3.0
                issue_months: [0, 1, 2, 3, 4, 5]
                year_range: [1991, 2021]

    guatemala:
        logo: Guatemala_IRI_120x48.png
        resolution: [1., 1.]
        center: [-89, 16]
        zoom: 8
        rotation: 0
        marker:  [-90, 16]
        origin: [0, 0]
        shapes:
            - name: National
              sql: select adm0_code as key, adm0_name as label, ST_AsBinary(the_geom) as the_geom
                  from iridb.g2015_2012_0 where adm0_name = 'Guatemala'
              vuln_sql: select adm0_code as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

            - name: Regional
              sql: select (adm0_code, adm1_code) as key, adm1_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_1
                  where adm0_name = 'Guatemala'
              vuln_sql: select (adm0_code, adm1_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

            - name: District
              sql: select (adm0_code, adm1_code, adm2_code) as key, adm2_name as label,
                  ST_AsBinary(the_geom) as the_geom from iridb.g2015_2014_2
                  where adm0_name = 'Guatemala'
              vuln_sql: select (adm0_code, adm1_code, adm2_code) as key, year, sum(vulnerability) as vuln
                  from public.fbf_vulnerability where adm0_name = 'Guatemala' group by 1, 2

        datasets:
            rain:
                path: rain-guatemala.zarr
                var_names:
                    rain: prcp_est
                    lat: Y
                    lon: X
                    time: T
                colormap: *raincm
            pnep:
                path: pnep-guatemala.zarr
                var_names:
                    pnep: pne
                    lat: Y
                    lon: X
                    issue: S
                    lead: null  # dataset has forecasts for only one season; L is implicit.
                    pct: P
                colormap: *pnepcm
            vuln:
                colormap: *vulncm
                range: [0.0, 5.0]
        seasons:
            season1:
                label: OND
                target_month: 10.5
                length: 3.0
                issue_months: [8]
                year_range: [1996, 2021]
